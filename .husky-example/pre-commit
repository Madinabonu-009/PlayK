#!/bin/sh
# Pre-commit hook to prevent committing sensitive files

# Colors
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üîç Checking for sensitive files..."

# Check if .env files are being committed
if git diff --cached --name-only | grep -E "\.env$|\.env\.local$"; then
    echo "${RED}‚ùå ERROR: Attempting to commit .env file!${NC}"
    echo "${YELLOW}These files contain sensitive data and should never be committed.${NC}"
    echo "Please remove them from staging:"
    echo "  git reset HEAD backend/.env"
    echo "  git reset HEAD bot/.env"
    exit 1
fi

# Check for potential secrets in code
if git diff --cached | grep -iE "(password|secret|api[_-]?key|token)\s*[:=]\s*['\"][^'\"]{10,}"; then
    echo "${YELLOW}‚ö†Ô∏è  WARNING: Potential secret detected in code!${NC}"
    echo "Please review your changes and ensure no sensitive data is being committed."
    echo "Press Ctrl+C to cancel, or Enter to continue anyway..."
    read
fi

# Check for console.log in production code (optional)
if git diff --cached --name-only | grep -E "\.(js|jsx)$" | xargs grep -l "console\.log" > /dev/null 2>&1; then
    echo "${YELLOW}‚ö†Ô∏è  WARNING: console.log found in code${NC}"
    echo "Consider removing console.log statements before committing."
fi

echo "‚úÖ Pre-commit checks passed"
exit 0
